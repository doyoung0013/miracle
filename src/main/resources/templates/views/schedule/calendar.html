<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{views/commons/layout::layout(~{::head}, ~{::main})}">

<head>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
    <!-- Bootstrap JS 및 Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"></script>
    <!-- 캘린더 CSS 및 JS -->
    <link rel="stylesheet" href="/css/schedule/calendar.css"> <!-- 정적 리소스 경로 확인 -->
    <script src="/js/schedule/calendar.js"></script> <!-- 정적 리소스 경로 확인 -->
</head>

<main>
    <div class="title">
        <h1>개인일정</h1>
    </div>
    <div class="container">
        <header class="content-header flex center">
            <button class="prev image-button"><i class="ri-arrow-left-s-line"></i></button>
            <h2 class="main-date"></h2>
            <button class="next image-button"><i class="ri-arrow-right-s-line"></i></button>
        </header>
        <section class="content-left calendar">
            <div class="calendar-header">
                <div class="day-header">일</div>
                <div class="day-header">월</div>
                <div class="day-header">화</div>
                <div class="day-header">수</div>
                <div class="day-header">목</div>
                <div class="day-header">금</div>
                <div class="day-header">토</div>
            </div>
            <div class="calendar-body">
                <!-- 실제 날짜가 들어갈 공간 -->
            </div>
        </section>
        <section class="content-right">
            <!-- 일정상세내용 -->

            <div class="content-right-msg">
                <!-- 선택된 날짜 표시 -->
                <div class="selected-date">
                    <p>선택한 날짜: <span th:text="${date}"></span></p> <!-- Thymeleaf 변수 사용 -->
                </div>

                <!-- 날짜 선택 입력란 -->
                <div class="date-selection">
                    <form th:action="@{/schedule/save}" method="post" onsubmit="return saveMemo()">
                        <!-- hidden field로 일정 번호 전송 -->
                        <input type="hidden" id="schNo" name="schNo" th:value="${dto.schNo}">

                        <label for="start-date">시작일:</label>
                        <input type="date" id="start-date" name="startAt"
                               th:value="${#dates.format(dto.startAt, 'yyyy-MM-dd')}" required>

                        <label for="end-date">종료일:</label>
                        <input type="date" id="end-date" name="finishAt"
                               th:value="${#dates.format(dto.finishAt, 'yyyy-MM-dd')}" required>
                    </form>
                </div>
                <hr>

                <!-- 메모 입력란 -->
                <div class="memo-section">
                    <label for="memo-title">메모 제목:</label>
                    <input type="text" id="memo-title" name="schTitle" th:value="${dto.schTitle}"
                           placeholder="메모 제목 입력" required>

                    <label for="memo-content">메모 내용:</label>
                    <textarea id="memo-content" name="schContent" placeholder="메모 내용 입력" required
                              th:text="${dto.schContent}"></textarea>

                    <button id="save-memo" type="submit">메모 저장</button>
                </div>
            </div>
        </section>
    </div>
</main>

<script th:inline="javascript">
    function saveMemo() {
        var formData = {
            employee: null, // 사원번호, 필요한 경우 추가
            startAt: document.getElementById('start-date').value,
            finishAt: document.getElementById('end-date').value,
            schTitle: document.getElementById('memo-title').value,
            schContent: document.getElementById('memo-content').value
        };

        fetch('/schedule/save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        }).then(response => response.text())
          .then(result => {
              if (result === 'success') {
                  alert('메모가 저장되었습니다.');
                  // 저장 성공 후 필요한 작업 수행 (예: 캘린더 업데이트)
                  // window.location.href = '/schedule/calendar'; // 캘린더 페이지로 이동 예시
              } else {
                  alert('메모 저장에 실패했습니다.');
              }
          }).catch(error => {
              console.error('Error saving memo:', error);
              alert('메모 저장 중 오류가 발생했습니다.');
          });

        return false; // 폼 제출 중지
    }
</script>

</html>
